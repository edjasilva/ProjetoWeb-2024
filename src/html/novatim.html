<!DOCTYPE html>
<html>
  <head>
    <title>Leaflet Map with Search</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <div id="map" style="height: 400px"></div>
    <input type="text" id="searchInput" placeholder="Search for a place" />
    <button onclick="searchPlace()">Search</button>

    <script>
      const map = L.map("map");
      map.setView([51.505, -0.09], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "Â© OpenStreetMap",
      }).addTo(map);

      let marker, circle, zoomed;

      navigator.geolocation.watchPosition(success, error);

      function success(pos) {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        const accuracy = pos.coords.accuracy;

        if (marker) {
          map.removeLayer(marker);
          map.removeLayer(circle);
        }

        marker = L.marker([lat, lng]).addTo(map);
        circle = L.circle([lat, lng], { radius: accuracy }).addTo(map);

        if (!zoomed) {
          zoomed = map.fitBounds(circle.getBounds());
        }

        map.setView([lat, lng]);
      }

      function error(err) {
        if (err.code === 1) {
          alert("Please allow access to geolocation.");
        } else {
          alert("Cannot obtain current location.");
        }
      }

      function searchPlace() {
        const query = document.getElementById("searchInput").value;
        if (query.trim() === "") {
          alert("Please enter a place to search.");
          return;
        }

        fetch(
          "https://nominatim.openstreetmap.org/search?format=json&q=" + query
        )
          .then((response) => response.json())
          .then((data) => {
            if (data.length > 0) {
              const result = data[0];
              const lat = result.lat;
              const lon = result.lon;
              if (marker) {
                map.removeLayer(marker);
              }
              marker = L.marker([lat, lon]).addTo(map);
              map.setView([lat, lon], 13);
            } else {
              alert("No results found for the search query.");
            }
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </body>
</html>
